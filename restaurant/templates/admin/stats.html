{% extends 'admin/base_site.html' %}

{% block content %}
<div style="padding: 20px;">
    <h1 style="color: #417690; border-bottom: 2px solid #417690; padding-bottom: 10px;">BÁO CÁO THỐNG KÊ NHÀ HÀNG</h1>

    <div style="display: flex; gap: 20px; margin: 20px 0;">
        <div style="flex: 1; background: #264b5d; color: white; padding: 20px; border-radius: 8px;">
            <h3>TỔNG DOANH THU</h3>
            <h2 id="total-revenue-text">{{ total_revenue|floatformat:0 }} VNĐ</h2>
        </div>
        <div style="flex: 1; background: #417690; color: white; padding: 20px; border-radius: 8px;">
            <h3>TỔNG LƯỢT ĐẶT BÀN</h3>
            <h2>{{ total_res }} lượt</h2>
        </div>
    </div>

    <div style="display: flex; flex-wrap: wrap; gap: 30px; align-items: flex-start;">
        <div style="flex: 1; min-width: 300px;">
            <h3>DANH SÁCH DOANH THU MÓN ĂN</h3>
            <ul style="list-style: none; padding: 0;">
                {% for s in food_stats %}
                <li style="padding: 10px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between;">
                    <span><strong>{{ s.food__name }}</strong></span>
                    <span style="color: #264b5d;">{{ s.total_revenue|floatformat:0 }} VNĐ ({{ s.total_qty }} món)</span>
                </li>
                {% empty %}
                <li>Chưa có dữ liệu bán hàng.</li>
                {% endfor %}
            </ul>
        </div>

        <div style="flex: 1; min-width: 350px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            <h3 style="text-align: center;">TỶ LỆ DOANH THU THEO MÓN</h3>
            <canvas id="restaurantChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    let labels = [];
    let revenueData = [];

    {% for s in food_stats %}
        labels.push('{{ s.food__name }}');
        revenueData.push({{ s.total_revenue }});
    {% endfor %}

    window.onload = function() {
        const ctx = document.getElementById('restaurantChart').getContext('2d');

        new Chart(ctx, {
            type: 'pie', 
            data: {
                labels: labels,
                datasets: [{
                    label: 'Doanh thu (VNĐ)',
                    data: revenueData,
                    backgroundColor: [
                        '#ff6384', '#36a2eb', '#cc65fe', '#ffce56', 
                        '#4bc0c0', '#ff9f40', '#9966ff', '#c9cbcf'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let value = context.raw;
                                return context.label + ': ' + value.toLocaleString() + ' VNĐ';
                            }
                        }
                    }
                }
            }
        });
    }
</script>

<style>
    h1, h2, h3 { font-family: "Roboto", "Lucida Grande", Verdana, Arial, sans-serif; }
</style>
{% endblock %}